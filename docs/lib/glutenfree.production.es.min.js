function never(e,t){throw new Error(t||fmt(`Unexpected object: ${e}`))}function fmt(e){return`Assertion Failed: ${e}`}function createProgram(e,t,r){const n=e.createProgram();if(!n)throw new Error("Could not create Program");if(e.attachShader(n,t),e.attachShader(n,r),e.linkProgram(n),e.getProgramParameter(n,e.LINK_STATUS))return n;const i=e.getProgramInfoLog(n);throw e.deleteProgram(n),new Error(`Could not link shader program: ${i}`)}function createShader(e,t,r){const n=e.createShader(t);if(!n)throw new Error("Could not create Shader");if(e.shaderSource(n,r),e.compileShader(n),e.getShaderParameter(n,e.COMPILE_STATUS))return n;const i=e.getShaderInfoLog(n);e.deleteShader(n);const a=r.split("\n").map((e,t)=>`${t+1}: ${e}`).join("\n");throw new Error(`Could not compile shader:\n${i}\n${a}`)}function isArray2(e){return!!e.length&&Array.isArray(e[0])}function shape2(e){const t=e.length;return[t,t?e[0].length:0]}function ravel2(e,t){const[r,n]=t,i=new Array(n*r);return e.forEach((e,t)=>{e.forEach((e,r)=>{i[n*t+r]=e})}),i}function locate(e,t,{attributes:r,elements:n}){return{attributes:Object.entries(r).reduce((r,[n,i])=>{if(INT_PATTERN.test(n))r[n]=i;else{const a=e.getAttribLocation(t,n);if(a===UNKNOWN_ATTRIB_LOCATION)throw new Error(`No location for attrib: ${n}`);r[a]=i}return r},{}),elements:n}}function access(e,t,r){return"function"==typeof r?r(e,t):r}function parseDepth(e){if(e)return new DepthDescriptor(e.func||513,"boolean"!=typeof e.mask||e.mask,e.range?e.range[0]:0,e.range?e.range[1]:1)}function parseStencil(e){if(e)return new StencilDescriptor("object"==typeof e.func.func?e.func.func.front:e.func.func,"object"==typeof e.func.func?e.func.func.back:e.func.func,void 0!==e.func.ref?"object"==typeof e.func.ref?e.func.ref.front:e.func.ref:1,void 0!==e.func.ref?"object"==typeof e.func.ref?e.func.ref.back:e.func.ref:1,void 0!==e.func.mask?"object"==typeof e.func.mask?e.func.mask.front:e.func.mask:255,void 0!==e.func.mask?"object"==typeof e.func.mask?e.func.mask.back:e.func.mask:255,void 0!==e.mask?"object"==typeof e.mask?e.mask.front:e.mask:255,void 0!==e.mask?"object"==typeof e.mask?e.mask.back:e.mask:255,e.op?"object"==typeof e.op.fail?e.op.fail.front:e.op.fail:7680,e.op?"object"==typeof e.op.fail?e.op.fail.back:e.op.fail:7680,e.op?"object"==typeof e.op.zfail?e.op.zfail.front:e.op.zfail:7680,e.op?"object"==typeof e.op.zfail?e.op.zfail.back:e.op.zfail:7680,e.op?"object"==typeof e.op.zpass?e.op.zpass.front:e.op.zpass:7680,e.op?"object"==typeof e.op.zpass?e.op.zpass.back:e.op.zpass:7680)}function parseBlend(e){if(e)return new BlendDescriptor("object"==typeof e.func.src?e.func.src.rgb:e.func.src,"object"==typeof e.func.src?e.func.src.alpha:e.func.src,"object"==typeof e.func.dst?e.func.dst.rgb:e.func.dst,"object"==typeof e.func.dst?e.func.dst.alpha:e.func.dst,e.equation?"object"==typeof e.equation?e.equation.rgb:e.equation:32774,e.equation?"object"==typeof e.equation?e.equation.alpha:e.equation:32774,e.color)}var Extension;!function(e){e.EXTColorBufferFloat="EXT_color_buffer_float",e.OESTextureFloatLinear="OES_texture_float_linear"}(Extension||(Extension={}));class Device{constructor(e,t,r,n){this.gl=e,this.canvas=t,this.explicitPixelRatio=r,this.explicitViewport=n}static mount(e=document.body,t){if(e instanceof HTMLCanvasElement)return Device.fromCanvas(e,t);const r=document.createElement("canvas");return e.appendChild(r),Device.fromCanvas(r,t)}static fromCanvas(e,t={}){const{antialias:r=!0,alpha:n=!0,depth:i=!0,stencil:a=!0,preserveDrawingBuffer:s=!1}=t.context||{},c=e.getContext("webgl2",{antialias:r,alpha:n,depth:i,stencil:a,preserveDrawingBuffer:s});if(!c)throw new Error("Could not get webgl2 context");return Device.fromContext(c,t)}static fromContext(e,{pixelRatio:t,viewport:r,extensions:n}={}){n&&n.forEach(t=>{if(!e.getExtension(t))throw new Error(`Could not get extension ${t}`)});const i=new Device(e,e.canvas,t,r);return i.update(),i}get bufferWidth(){return this.gl.drawingBufferWidth}get bufferHeight(){return this.gl.drawingBufferHeight}get canvasWidth(){return this.canvas.width}get canvasHeight(){return this.canvas.height}get canvasCSSWidth(){return this.canvas.clientWidth}get canvasCSSHeight(){return this.canvas.clientHeight}get pixelRatio(){return this.explicitPixelRatio||window.devicePixelRatio}update(){const e=this.pixelRatio,t=this.canvas,r=this.explicitViewport&&this.explicitViewport[0]||t.clientWidth*e,n=this.explicitViewport&&this.explicitViewport[1]||t.clientHeight*e;r!==t.width&&(t.width=r),n!==t.height&&(t.height=n)}clearColorBuffer(e,t,r,n,i){const a=this.gl;i&&a.bindFramebuffer(a.FRAMEBUFFER,i.glFramebuffer),a.clearColor(e,t,r,n),a.clear(a.COLOR_BUFFER_BIT),i&&a.bindFramebuffer(a.FRAMEBUFFER,null)}clearDepthBuffer(e,t){const r=this.gl;t&&r.bindFramebuffer(r.FRAMEBUFFER,t.glFramebuffer),r.clearDepth(e),r.clear(r.DEPTH_BUFFER_BIT),t&&r.bindFramebuffer(r.FRAMEBUFFER,null)}clearStencilBuffer(e,t){const r=this.gl;t&&r.bindFramebuffer(r.FRAMEBUFFER,t.glFramebuffer),r.clearStencil(e),r.clear(r.STENCIL_BUFFER_BIT),t&&r.bindFramebuffer(r.FRAMEBUFFER,null)}clearColorAndDepthBuffers(e,t,r,n,i,a){const s=this.gl;a&&s.bindFramebuffer(s.FRAMEBUFFER,a.glFramebuffer),s.clearColor(e,t,r,n),s.clearDepth(i),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT),a&&s.bindFramebuffer(s.FRAMEBUFFER,null)}clearDepthAndStencilBuffers(e,t,r){const n=this.gl;r&&n.bindFramebuffer(n.FRAMEBUFFER,r.glFramebuffer),n.clearDepth(e),n.clearStencil(t),n.clear(n.DEPTH_BUFFER_BIT|n.STENCIL_BUFFER_BIT),r&&n.bindFramebuffer(n.FRAMEBUFFER,null)}clearColorAndStencilBuffers(e,t,r,n,i,a){const s=this.gl;a&&s.bindFramebuffer(s.FRAMEBUFFER,a.glFramebuffer),s.clearColor(e,t,r,n),s.clearStencil(i),s.clear(s.COLOR_BUFFER_BIT|s.STENCIL_BUFFER_BIT),a&&s.bindFramebuffer(s.FRAMEBUFFER,null)}clear(e,t,r,n,i,a,s){const c=this.gl;s&&c.bindFramebuffer(c.FRAMEBUFFER,s.glFramebuffer),c.clearColor(e,t,r,n),c.clearDepth(i),c.clearStencil(a),c.clear(c.COLOR_BUFFER_BIT|c.DEPTH_BUFFER_BIT|c.STENCIL_BUFFER_BIT),s&&c.bindFramebuffer(c.FRAMEBUFFER,null)}}var VertexBufferType;!function(e){e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT"}(VertexBufferType||(VertexBufferType={}));class VertexBuffer{constructor(e,t,r){this.gl=e,this.type=t,this.data=r,this.glBuffer=null,this.init()}static create(e,t){const r=e instanceof Device?e.gl:e;switch(t.type){case 5120:return VertexBuffer.fromInt8Array(r,t.data);case 5122:return VertexBuffer.fromInt16Array(r,t.data);case 5124:return VertexBuffer.fromInt32Array(r,t.data);case 5121:return VertexBuffer.fromUint8Array(r,t.data);case 5123:return VertexBuffer.fromUint16Array(r,t.data);case 5125:return VertexBuffer.fromUint32Array(r,t.data);case 5126:return VertexBuffer.fromFloat32Array(r,t.data);default:return never(t)}}static fromInt8Array(e,t){const r=e instanceof Device?e.gl:e;return new VertexBuffer(r,5120,t instanceof Int8Array?t:new Int8Array(t))}static fromInt16Array(e,t){const r=e instanceof Device?e.gl:e;return new VertexBuffer(r,5122,t instanceof Int16Array?t:new Int16Array(t))}static fromInt32Array(e,t){const r=e instanceof Device?e.gl:e;return new VertexBuffer(r,5124,t instanceof Int32Array?t:new Int32Array(t))}static fromUint8Array(e,t){const r=e instanceof Device?e.gl:e;return new VertexBuffer(r,5121,t instanceof Uint8Array?t:new Uint8Array(t))}static fromUint16Array(e,t){const r=e instanceof Device?e.gl:e;return new VertexBuffer(r,5123,t instanceof Uint16Array?t:new Uint16Array(t))}static fromUint32Array(e,t){const r=e instanceof Device?e.gl:e;return new VertexBuffer(r,5125,t instanceof Uint32Array?t:new Uint32Array(t))}static fromFloat32Array(e,t){const r=e instanceof Device?e.gl:e;return new VertexBuffer(r,5126,t instanceof Float32Array?t:new Float32Array(t))}get count(){return this.data.length}init(){const{gl:e,data:t}=this,r=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,r),e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,null),this.glBuffer=r}restore(){const{gl:e,glBuffer:t}=this;e.isBuffer(t)||this.init()}}var ElementBufferType;!function(e){e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT"}(ElementBufferType||(ElementBufferType={}));var Primitive;!function(e){e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(Primitive||(Primitive={}));class ElementBuffer{static create(e,t){return Array.isArray(t)?ElementBuffer.fromArray(e,t):ElementBuffer.fromUint32Array(e,t.data,t.primitive)}static fromArray(e,t){if(isArray2(t)){const r=shape2(t),n=ravel2(t,r),i=3===r[1]?4:1;return ElementBuffer.fromUint32Array(e,n,i)}return ElementBuffer.fromUint32Array(e,t,0)}static fromUint16Array(e,t,r){const n=e instanceof Device?e.gl:e,i=Array.isArray(t)?new Uint16Array(t):t;return new ElementBuffer(n,i,5123,r)}static fromUint32Array(e,t,r){const n=e instanceof Device?e.gl:e,i=Array.isArray(t)?new Uint32Array(t):t;return new ElementBuffer(n,i,5125,r)}constructor(e,t,r,n){this.gl=e,this.data=t,this.type=r,this.primitive=n,this.glBuffer=null,this.init()}get count(){return this.data.length}init(){const{gl:e,data:t}=this,r=e.createBuffer();e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,r),e.bufferData(e.ELEMENT_ARRAY_BUFFER,t,e.STATIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),this.glBuffer=r}restore(){const{gl:e,glBuffer:t}=this;e.isBuffer(t)||this.init()}}const INT_PATTERN$1=/^0|[1-9]\d*$/;var AttributeType;!function(e){e.POINTER="pointer",e.IPOINTER="ipointer"}(AttributeType||(AttributeType={}));class VertexArray{static create(e,{attributes:t,elements:r}){const n=e instanceof Device?e.gl:e,i=Object.entries(t).map(([e,t])=>{if(!INT_PATTERN$1.test(e))throw new Error("Location not a number. Use Command#locate");const r=parseInt(e,10);return AttributeDescriptor.create(n,r,t)}),a=r?r instanceof ElementBuffer?r:ElementBuffer.create(n,r):void 0,s=a?a.count:i.length?i.map(e=>e.count).reduce((e,t)=>Math.min(e,t)):0,c=i.filter(e=>!!e.divisor),o=c.length?c.map(e=>e.count*e.divisor).reduce((e,t)=>Math.min(e,t)):0;return new VertexArray(n,i,a,s,o)}constructor(e,t,r,n,i){this.gl=e,this.elementBuffer=r,this.attributes=t,this.count=n,this.instanceCount=i,this.glVertexArray=null,this.init()}get hasElements(){return!!this.elementBuffer}get elementPrimitive(){return this.elementBuffer&&this.elementBuffer.primitive}get elementType(){return this.elementBuffer&&this.elementBuffer.type}init(){const{gl:e,attributes:t,elementBuffer:r}=this;if(!e.isContextLost()){const n=e.createVertexArray();e.bindVertexArray(n),t.forEach(({location:t,type:r,buffer:{glBuffer:n,type:i},size:a,normalized:s=!1,divisor:c})=>{switch(e.enableVertexAttribArray(t),e.bindBuffer(e.ARRAY_BUFFER,n),r){case"pointer":e.vertexAttribPointer(t,a,i,s,0,0);break;case"ipointer":e.vertexAttribIPointer(t,a,i,0,0);break;default:never(r)}c&&e.vertexAttribDivisor(t,c)}),r&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,r.glBuffer),e.bindVertexArray(null),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),this.glVertexArray=n}}restore(){const{gl:e,glVertexArray:t,attributes:r,elementBuffer:n}=this;n&&n.restore(),r.forEach(e=>e.buffer.restore()),e.isVertexArray(t)||this.init()}}class AttributeDescriptor{constructor(e,t,r,n,i,a,s){this.location=e,this.type=t,this.buffer=r,this.count=n,this.size=i,this.normalized=a,this.divisor=s}static create(e,t,r){if(Array.isArray(r)){if(isArray2(r)){const n=shape2(r),i=ravel2(r,n);return new AttributeDescriptor(t,"pointer",VertexBuffer.fromFloat32Array(e,i),n[0],n[1],!1,0)}return new AttributeDescriptor(t,"pointer",VertexBuffer.fromFloat32Array(e,r),r.length,1,!1,0)}const n=r.value instanceof VertexBuffer?r.value:VertexBuffer.create(e,r.value);switch(r.type){case"pointer":return new AttributeDescriptor(t,r.type,n,r.count,r.size,r.normalized||!1,r.divisor||0);case"ipointer":return new AttributeDescriptor(t,r.type,n,r.count,r.size,!1,r.divisor||0);default:return never(r)}}}class Framebuffer{static create(e,{width:t,height:r,color:n,depth:i,stencil:a}){const s=e instanceof Device?e.gl:e,c=Array.isArray(n)?n:[n];return c.forEach(e=>{}),new Framebuffer(s,t,r,c,i,a)}constructor(e,t,r,n,i,a){this.gl=e,this.width=t,this.height=r,this.colorBuffers=n,this.depthBuffer=i,this.stencilBuffer=a,this.glColorAttachments=n.map((t,r)=>e.COLOR_ATTACHMENT0+r),this.glFramebuffer=null,this.init()}init(){const{gl:e,colorBuffers:t,depthBuffer:r,stencilBuffer:n}=this,i=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,i),t.forEach((t,r)=>{e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+r,e.TEXTURE_2D,t.glTexture,0)}),r&&e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,r,0),n&&e.framebufferTexture2D(e.FRAMEBUFFER,e.STENCIL_ATTACHMENT,e.TEXTURE_2D,n,0);const a=e.checkFramebufferStatus(e.FRAMEBUFFER);if(e.bindFramebuffer(e.FRAMEBUFFER,null),a!==e.FRAMEBUFFER_COMPLETE)throw e.deleteFramebuffer(i),new Error("Framebuffer not complete");this.glFramebuffer=i}restore(){const{gl:e,glFramebuffer:t,colorBuffers:r,depthBuffer:n,stencilBuffer:i}=this;r.forEach(e=>e.restore()),n&&n.restore(),i&&i.restore(),e.isFramebuffer(t)||this.init()}}const INT_PATTERN=/^0|[1-9]\d*$/,UNKNOWN_ATTRIB_LOCATION=-1;var DepthFunc;!function(e){e[e.ALWAYS=519]="ALWAYS",e[e.NEVER=512]="NEVER",e[e.EQUAL=514]="EQUAL",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.LESS=513]="LESS",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.GEQUAL=518]="GEQUAL"}(DepthFunc||(DepthFunc={}));var StencilFunc;!function(e){e[e.ALWAYS=519]="ALWAYS",e[e.NEVER=512]="NEVER",e[e.EQUAL=514]="EQUAL",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.LESS=513]="LESS",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.GEQUAL=518]="GEQUAL"}(StencilFunc||(StencilFunc={}));var StencilOp;!function(e){e[e.KEEP=7680]="KEEP",e[e.ZERO=0]="ZERO",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR=7683]="DECR",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.INVERT=5386]="INVERT"}(StencilOp||(StencilOp={}));var BlendFunc;!function(e){e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA"}(BlendFunc||(BlendFunc={}));var BlendEquation;!function(e){e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.MIN=32775]="MIN",e[e.MAX=32776]="MAX"}(BlendEquation||(BlendEquation={}));class Command{constructor(e,t,r,n,i,a,s,c,o,f,u){this.gl=e,this.glProgram=t,this.primitive="number"==typeof a?a:void 0,this.uniformDescrs=r,this.count=n,this.offset=i,this.vertexArrayAcc=s,this.framebufferAcc=c,this.depthDescr=o,this.stencilDescr=f,this.blendDescr=u,this.currVao=null,this.currFbo=null}static create(e,{vert:t,frag:r,uniforms:n={},data:i,framebuffer:a,count:s=0,offset:c=0,primitive:o,depth:f,stencil:u,blend:l}){const E=e instanceof Device?e.gl:e,R=createShader(E,E.VERTEX_SHADER,t),A=createShader(E,E.FRAGMENT_SHADER,r),h=createProgram(E,R,A);E.deleteShader(R),E.deleteShader(A);const T=Object.entries(n).map(([e,t])=>{const r=E.getUniformLocation(h,e);if(!r)throw new Error(`No location for uniform: ${e}`);return new UniformDescriptor(e,r,t)}),m=i?"function"==typeof i||i instanceof VertexArray?i:VertexArray.create(e,locate(E,h,i)):void 0,F=a?"function"==typeof a||a instanceof Framebuffer?a:Framebuffer.create(E,a):void 0,p=parseDepth(f),B=parseStencil(u),d=parseBlend(l);return new Command(E,h,T,s,c,o,m,F,p,B,d)}execute(e){const{gl:t,glProgram:r}=this;t.useProgram(r),this.beginDepth(),this.beginStencil(),this.beginBlend(),Array.isArray(e)?e.forEach((e,t)=>this.executeInner(e,t)):this.executeInner(e,0),this.unbindFbo(),this.unbindVao(),this.endBlend(),this.endStencil(),this.endDepth(),t.useProgram(null)}locate(e){return locate(this.gl,this.glProgram,e)}executeInner(e,t){const{gl:r,primitive:n,count:i,offset:a,vertexArrayAcc:s,framebufferAcc:c}=this;let o=r.drawingBufferWidth,f=r.drawingBufferHeight;const u=c&&access(e,t,c);u&&(this.bindFbo(u),o=u.width,f=u.height),r.viewport(0,0,o,f),this.updateUniforms(e,t);const l=s&&access(e,t,s);if(l){this.bindVao(l);const e=void 0===n?void 0===l.elementPrimitive?r.TRIANGLES:l.elementPrimitive:n,t=i?Math.min(i,l.count):l.count;if(l.hasElements){const r=l.elementType;this.drawElements(e,t,r,a,l.instanceCount)}else this.drawArrays(e,t,a,l.instanceCount)}else this.drawArrays(void 0===n?r.TRIANGLES:n,i,a,0)}bindVao(e){e!==this.currVao&&(this.currVao=e,this.gl.bindVertexArray(e.glVertexArray))}unbindVao(){this.gl.bindVertexArray(null),this.currVao=null}bindFbo(e){const t=this.gl;e!==this.currFbo&&(this.currFbo=e,t.bindFramebuffer(t.FRAMEBUFFER,e.glFramebuffer),t.drawBuffers(e.glColorAttachments))}unbindFbo(){const e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,null),this.currFbo=null}beginDepth(){const{gl:e,depthDescr:t}=this;t&&(e.enable(e.DEPTH_TEST),e.depthFunc(t.func),e.depthMask(t.mask),e.depthRange(t.rangeStart,t.rangeEnd))}endDepth(){const{gl:e,depthDescr:t}=this;t&&e.disable(e.DEPTH_TEST)}beginStencil(){const{gl:e,stencilDescr:t}=this;if(t){const{fFunc:r,bFunc:n,fFuncRef:i,bfuncRef:a,fFuncMask:s,bFuncMask:c,fMask:o,bMask:f,fOpFail:u,bOpFail:l,fOpZFail:E,bOpZFail:R,fOpZPass:A,bOpZPass:h}=t;e.enable(e.STENCIL_TEST),e.stencilFuncSeparate(e.FRONT,r,i,s),e.stencilFuncSeparate(e.BACK,n,a,c),e.stencilMaskSeparate(e.FRONT,o),e.stencilMaskSeparate(e.BACK,f),e.stencilOpSeparate(e.FRONT,u,E,A),e.stencilOpSeparate(e.BACK,l,R,h)}}endStencil(){const{gl:e,stencilDescr:t}=this;t&&e.disable(e.STENCIL_TEST)}beginBlend(){const{gl:e,blendDescr:t}=this;if(t&&(e.enable(e.BLEND),e.blendFuncSeparate(t.srcRGB,t.dstRGB,t.srcAlpha,t.dstAlpha),e.blendEquationSeparate(t.equationRGB,t.equationAlpha),t.color)){const[r,n,i,a]=t.color;e.blendColor(r,n,i,a)}}endBlend(){const{gl:e,blendDescr:t}=this;t&&e.disable(e.BLEND)}drawArrays(e,t,r,n){n?this.gl.drawArraysInstanced(e,r,t,n):this.gl.drawArrays(e,r,t)}drawElements(e,t,r,n,i){const a=this.gl;i?a.drawElementsInstanced(e,t,r,n,i):a.drawElements(e,t,r,n)}updateUniforms(e,t){const r=this.gl;let n=0;this.uniformDescrs.forEach(({identifier:i,location:a,definition:s})=>{switch(s.type){case"1f":r.uniform1f(a,access(e,t,s.value));break;case"1fv":r.uniform1fv(a,access(e,t,s.value));break;case"1i":r.uniform1i(a,access(e,t,s.value));break;case"1iv":r.uniform1iv(a,access(e,t,s.value));break;case"1ui":r.uniform1ui(a,access(e,t,s.value));break;case"1uiv":r.uniform1uiv(a,access(e,t,s.value));break;case"2f":{const[n,i]=access(e,t,s.value);r.uniform2f(a,n,i);break}case"2fv":r.uniform2fv(a,access(e,t,s.value));break;case"2i":{const[n,i]=access(e,t,s.value);r.uniform2i(a,n,i);break}case"2iv":r.uniform2iv(a,access(e,t,s.value));break;case"2ui":{const[n,i]=access(e,t,s.value);r.uniform2ui(a,n,i);break}case"2uiv":r.uniform2uiv(a,access(e,t,s.value));break;case"3f":{const[n,i,c]=access(e,t,s.value);r.uniform3f(a,n,i,c);break}case"3fv":r.uniform3fv(a,access(e,t,s.value));break;case"3i":{const[n,i,c]=access(e,t,s.value);r.uniform3i(a,n,i,c);break}case"3iv":r.uniform3iv(a,access(e,t,s.value));break;case"3ui":{const[n,i,c]=access(e,t,s.value);r.uniform3ui(a,n,i,c);break}case"3uiv":r.uniform3uiv(a,access(e,t,s.value));break;case"4f":{const[n,i,c,o]=access(e,t,s.value);r.uniform4f(a,n,i,c,o);break}case"4fv":r.uniform4fv(a,access(e,t,s.value));break;case"4i":{const[n,i,c,o]=access(e,t,s.value);r.uniform4i(a,n,i,c,o);break}case"4iv":r.uniform4iv(a,access(e,t,s.value));break;case"4ui":{const[n,i,c,o]=access(e,t,s.value);r.uniform4ui(a,n,i,c,o);break}case"4uiv":r.uniform4uiv(a,access(e,t,s.value));break;case"matrix2fv":r.uniformMatrix2fv(a,!1,access(e,t,s.value));break;case"matrix3fv":r.uniformMatrix3fv(a,!1,access(e,t,s.value));break;case"matrix4fv":r.uniformMatrix4fv(a,!1,access(e,t,s.value));break;case"texture":const c=access(e,t,s.value),o=n++;r.activeTexture(r.TEXTURE0+o),r.bindTexture(r.TEXTURE_2D,c.glTexture),r.uniform1i(a,o);break;default:never(s,`Unknown uniform type: (${i})`)}})}}class DepthDescriptor{constructor(e,t,r,n){this.func=e,this.mask=t,this.rangeStart=r,this.rangeEnd=n}}class StencilDescriptor{constructor(e,t,r,n,i,a,s,c,o,f,u,l,E,R){this.fFunc=e,this.bFunc=t,this.fFuncRef=r,this.bfuncRef=n,this.fFuncMask=i,this.bFuncMask=a,this.fMask=s,this.bMask=c,this.fOpFail=o,this.bOpFail=f,this.fOpZFail=u,this.bOpZFail=l,this.fOpZPass=E,this.bOpZPass=R}}class BlendDescriptor{constructor(e,t,r,n,i,a,s){this.srcRGB=e,this.srcAlpha=t,this.dstRGB=r,this.dstAlpha=n,this.equationRGB=i,this.equationAlpha=a,this.color=s}}class UniformDescriptor{constructor(e,t,r){this.identifier=e,this.location=t,this.definition=r}}var TextureWrap;!function(e){e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.REPEAT=10497]="REPEAT",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}(TextureWrap||(TextureWrap={}));var TextureFilter;!function(e){e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"}(TextureFilter||(TextureFilter={}));var TextureInternalFormat;!function(e){e[e.R8=33321]="R8",e[e.R8_SNORM=36756]="R8_SNORM",e[e.R8UI=33330]="R8UI",e[e.R8I=33329]="R8I",e[e.R16UI=33332]="R16UI",e[e.R16I=33331]="R16I",e[e.R32UI=33334]="R32UI",e[e.R32I=33333]="R32I",e[e.R16F=33325]="R16F",e[e.R32F=33326]="R32F",e[e.RG8=33323]="RG8",e[e.RG8_SNORM=36757]="RG8_SNORM",e[e.RG8UI=33336]="RG8UI",e[e.RG8I=33335]="RG8I",e[e.RG16UI=33338]="RG16UI",e[e.RG16I=33337]="RG16I",e[e.RG32UI=33340]="RG32UI",e[e.RG32I=33339]="RG32I",e[e.RG16F=33327]="RG16F",e[e.RG32F=33328]="RG32F",e[e.RGB8=32849]="RGB8",e[e.RGB8_SNORM=36758]="RGB8_SNORM",e[e.RGB8UI=36221]="RGB8UI",e[e.RGB8I=36239]="RGB8I",e[e.RGB16UI=36215]="RGB16UI",e[e.RGB16I=36233]="RGB16I",e[e.RGB32UI=36209]="RGB32UI",e[e.RGB32I=36227]="RGB32I",e[e.RGB16F=34843]="RGB16F",e[e.RGB32F=34837]="RGB32F",e[e.RGBA8=32856]="RGBA8",e[e.RGBA8_SNORM=36759]="RGBA8_SNORM",e[e.RGBA8UI=36220]="RGBA8UI",e[e.RGBA8I=36238]="RGBA8I",e[e.RGBA16UI=36214]="RGBA16UI",e[e.RGBA16I=36232]="RGBA16I",e[e.RGBA32UI=36208]="RGBA32UI",e[e.RGBA32I=36226]="RGBA32I",e[e.RGBA16F=34842]="RGBA16F",e[e.RGBA32F=34836]="RGBA32F"}(TextureInternalFormat||(TextureInternalFormat={}));var TextureFormat;!function(e){e[e.RED=6403]="RED",e[e.RG=33319]="RG",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.RED_INTEGER=36244]="RED_INTEGER",e[e.RG_INTEGER=33320]="RG_INTEGER",e[e.RGB_INTEGER=36248]="RGB_INTEGER",e[e.RGBA_INTEGER=36249]="RGBA_INTEGER"}(TextureFormat||(TextureFormat={}));var TextureType;!function(e){e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT"}(TextureType||(TextureType={}));class Texture{static fromImage(e,t,r){return Texture.fromRGBA8(e,t.data,t.width,t.height,r)}static fromRGBA8(e,t,r,n,i){return Texture.fromArrayBufferView(e,!t||t instanceof Uint8Array?t:new Uint8Array(t),r,n,32856,6408,5121,i)}static fromRG16F(e,t,r,n,i){return Texture.fromArrayBufferView(e,!t||t instanceof Float32Array?t:new Float32Array(t),r,n,33327,33319,5126,i)}static fromRGB16F(e,t,r,n,i){return Texture.fromArrayBufferView(e,!t||t instanceof Float32Array?t:new Float32Array(t),r,n,34843,6407,5126,i)}static fromRGBA16F(e,t,r,n,i){return Texture.fromArrayBufferView(e,!t||t instanceof Float32Array?t:new Float32Array(t),r,n,34842,6408,5126,i)}static fromRGB32F(e,t,r,n,i){return Texture.fromArrayBufferView(e,!t||t instanceof Float32Array?t:new Float32Array(t),r,n,34837,6407,5126,i)}static fromRGBA32F(e,t,r,n,i){return Texture.fromArrayBufferView(e,!t||t instanceof Float32Array?t:new Float32Array(t),r,n,34836,6408,5126,i)}static fromArrayBufferView(e,t,r,n,i,a,s,{min:c=9728,mag:o=9728,wrapS:f=33071,wrapT:u=33071,mipmap:l=!1}={}){const E=e instanceof Device?e.gl:e;return new Texture(E,t,r,n,i,a,s,f,u,c,o,l)}constructor(e,t,r,n,i,a,s,c,o,f,u,l){this.gl=e,this.data=t,this.width=r,this.height=n,this.internalFormat=i,this.format=a,this.type=s,this.wrapS=c,this.wrapT=o,this.minFilter=f,this.magFilter=u,this.mipmap=l,this.glTexture=null,this.init()}init(){const{gl:e,data:t,width:r,height:n,internalFormat:i,format:a,type:s,wrapS:c,wrapT:o,minFilter:f,magFilter:u,mipmap:l}=this,E=e.createTexture();e.bindTexture(e.TEXTURE_2D,E),e.texStorage2D(e.TEXTURE_2D,1,i,r,n),t&&e.texSubImage2D(e.TEXTURE_2D,0,0,0,r,n,a,s,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,c),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,o),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,f),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,u),l&&e.generateMipmap(e.TEXTURE_2D),e.bindTexture(e.TEXTURE_2D,null),this.glTexture=E}restore(){const{gl:e,glTexture:t}=this;e.isTexture(t)||this.init()}}export{Device,Extension,Command,DepthFunc,StencilFunc,StencilOp,BlendFunc,BlendEquation,VertexBuffer,VertexBufferType,ElementBuffer,ElementBufferType,Primitive,VertexArray,Texture,TextureType,TextureFilter,TextureWrap,TextureInternalFormat,TextureFormat,Framebuffer};
//# sourceMappingURL=glutenfree.production.es.min.js.map
