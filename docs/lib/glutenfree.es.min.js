function never(e,r){throw new Error(fmt(r||`Unexpected object: ${e}`))}function fmt(e){return e?`Assertion Failed: ${e}`:"Assertion Failed"}function createProgram(e,r,t){const a=e.createProgram();if(!a)throw new Error("Could not create Program");if(e.attachShader(a,r),e.attachShader(a,t),e.linkProgram(a),e.getProgramParameter(a,e.LINK_STATUS))return a;const n=e.getProgramInfoLog(a);throw e.deleteProgram(a),new Error(`Could not link shader program: ${n}`)}function createShader(e,r,t){const a=e.createShader(r);if(!a)throw new Error("Could not create Shader");if(e.shaderSource(a,t),e.compileShader(a),e.getShaderParameter(a,e.COMPILE_STATUS))return a;const n=e.getShaderInfoLog(a);e.deleteShader(a);const c=t.split("\n").map((e,r)=>`${r+1}: ${e}`).join("\n");throw new Error(`Could not compile shader:\n${n}\n${c}`)}function createArrayBuffer(e,r){const t=e.createBuffer();if(!t)throw new Error("Could not create buffer");return e.bindBuffer(e.ARRAY_BUFFER,t),e.bufferData(e.ARRAY_BUFFER,Array.isArray(r)?new Float32Array(r):r,e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,null),t}function createElementArrayBuffer(e,r){const t=e.createBuffer();if(!t)throw new Error("Could not create buffer");return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t),e.bufferData(e.ELEMENT_ARRAY_BUFFER,Array.isArray(r)?new Uint32Array(r):r,e.STATIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),t}function createVertexArray(e,r,t){const a=e.createVertexArray();if(!a)throw new Error("Could not create Vertex Array Object");return e.bindVertexArray(a),r.forEach(({type:r,buffer:t,bufferType:a,size:n,location:c,normalized:s=!1,divisor:i})=>{switch(e.enableVertexAttribArray(c),e.bindBuffer(e.ARRAY_BUFFER,t),r){case 0:e.vertexAttribPointer(c,n,a,s,0,0);break;case 1:e.vertexAttribIPointer(c,n,a,0,0);break;default:never(r)}i&&e.vertexAttribDivisor(c,i)}),t&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t),e.bindVertexArray(null),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),a}function createTexture(e,r,t,a,n,c,s,i,u,o,f,l){const R=e.createTexture();if(!R)throw new Error("Could not create texture");return e.bindTexture(e.TEXTURE_2D,R),e.texStorage2D(e.TEXTURE_2D,1,n,t,a),r&&e.texSubImage2D(e.TEXTURE_2D,0,0,0,t,a,c,s,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,i),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,u),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,o),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,f),l&&e.generateMipmap(e.TEXTURE_2D),e.bindTexture(e.TEXTURE_2D,null),R}function is2DArray(e){return!!e.length||Array.isArray(e[0])}function ravel(e){const r=e.length,t=r?e[0].length:0,a=new Array(t*r);return e.forEach((e,r)=>{e.forEach((e,n)=>{a[t*r+n]=e})}),{data:a,shape:[r,t]}}function locate(e,r,{attributes:t,elements:a}){return{attributes:Object.entries(t).reduce((t,[a,n])=>{if(INT_PATTERN.test(a))t[a]=n;else{const c=e.getAttribLocation(r,a);if(c===UNKNOWN_ATTRIB_LOCATION)throw new Error(`No location for attrib: ${a}`);t[c]=n}return t},{}),elements:a}}function access(e,r,t){return"function"==typeof t?t(e,r):t}function mapGlPrimitive(e,r){switch(r){case"triangles":return e.TRIANGLES;case"triangle-strip":return e.TRIANGLE_STRIP;case"triangle-fan":return e.TRIANGLE_FAN;case"points":return e.POINTS;case"lines":return e.LINES;case"line-strip":return e.LINE_STRIP;case"line-loop":return e.LINE_LOOP;default:return never(r)}}function mapGlDepthOrStencilFunc(e,r){switch(r){case"always":return e.ALWAYS;case"never":return e.NEVER;case"equal":return e.EQUAL;case"notequal":return e.NOTEQUAL;case"less":return e.LESS;case"lequal":return e.LEQUAL;case"greater":return e.GREATER;case"gequal":return e.GEQUAL;default:return never(r)}}function mapGlStencilOp(e,r){switch(r){case"keep":return e.KEEP;case"zero":return e.ZERO;case"replace":return e.REPLACE;case"incr":return e.INCR;case"incr-wrap":return e.INCR_WRAP;case"decr":return e.DECR;case"decr-wrap":return e.DECR_WRAP;case"invert":return e.INVERT;default:return never(r)}}function mapGlBlendFunc(e,r){switch(r){case"zero":return e.ZERO;case"one":return e.ONE;case"src-color":return e.SRC_COLOR;case"src-alpha":return e.SRC_ALPHA;case"one-minus-src-color":return e.ONE_MINUS_SRC_COLOR;case"one-minus-src-alpha":return e.ONE_MINUS_SRC_ALPHA;case"dst-color":return e.DST_COLOR;case"dst-alpha":return e.DST_ALPHA;case"one-minus-dst-color":return e.ONE_MINUS_DST_COLOR;case"one-minus-dst-alpha":return e.ONE_MINUS_DST_ALPHA;case"constant-color":return e.CONSTANT_COLOR;case"constant-alpha":return e.CONSTANT_ALPHA;case"one-minus-constant-color":return e.ONE_MINUS_CONSTANT_COLOR;case"one-minus-constant-alpha":return e.ONE_MINUS_CONSTANT_ALPHA;default:return never(r)}}function mapGlBlendEquation(e,r){switch(r){case"add":return e.FUNC_ADD;case"subtract":return e.FUNC_SUBTRACT;case"reverse-subtract":return e.FUNC_REVERSE_SUBTRACT;case"min":return e.MIN;case"max":return e.MAX;default:return never(r)}}function parseDepth(e,r){if(r)return new DepthDescriptor(mapGlDepthOrStencilFunc(e,r.func||"less"),"boolean"!=typeof r.mask||r.mask,r.range?r.range[0]:0,r.range?r.range[1]:1)}function parseStencil(e,r){if(r)return new StencilDescriptor(mapGlDepthOrStencilFunc(e,"object"==typeof r.func.func?r.func.func.front:r.func.func),mapGlDepthOrStencilFunc(e,"object"==typeof r.func.func?r.func.func.back:r.func.func),void 0!==r.func.ref?"object"==typeof r.func.ref?r.func.ref.front:r.func.ref:1,void 0!==r.func.ref?"object"==typeof r.func.ref?r.func.ref.back:r.func.ref:1,void 0!==r.func.mask?"object"==typeof r.func.mask?r.func.mask.front:r.func.mask:255,void 0!==r.func.mask?"object"==typeof r.func.mask?r.func.mask.back:r.func.mask:255,void 0!==r.mask?"object"==typeof r.mask?r.mask.front:r.mask:255,void 0!==r.mask?"object"==typeof r.mask?r.mask.back:r.mask:255,mapGlStencilOp(e,r.op?"object"==typeof r.op.sfail?r.op.sfail.front:r.op.sfail:"keep"),mapGlStencilOp(e,r.op?"object"==typeof r.op.sfail?r.op.sfail.back:r.op.sfail:"keep"),mapGlStencilOp(e,r.op?"object"==typeof r.op.dfail?r.op.dfail.front:r.op.dfail:"keep"),mapGlStencilOp(e,r.op?"object"==typeof r.op.dfail?r.op.dfail.back:r.op.dfail:"keep"),mapGlStencilOp(e,r.op?"object"==typeof r.op.dpass?r.op.dpass.front:r.op.dpass:"keep"),mapGlStencilOp(e,r.op?"object"==typeof r.op.dpass?r.op.dpass.back:r.op.dpass:"keep"))}function parseBlend(e,r){if(r)return new BlendDescriptor(mapGlBlendFunc(e,"object"==typeof r.func.src?r.func.src.rgb:r.func.src),mapGlBlendFunc(e,"object"==typeof r.func.src?r.func.src.alpha:r.func.src),mapGlBlendFunc(e,"object"==typeof r.func.dst?r.func.dst.rgb:r.func.dst),mapGlBlendFunc(e,"object"==typeof r.func.dst?r.func.dst.alpha:r.func.dst),mapGlBlendEquation(e,r.equation?"object"==typeof r.equation?r.equation.rgb:r.equation:"add"),mapGlBlendEquation(e,r.equation?"object"==typeof r.equation?r.equation.alpha:r.equation:"add"),r.color)}function mapGlTextureWrap(e,r){switch(r){case"clamp-to-edge":return e.CLAMP_TO_EDGE;case"repeat":return e.REPEAT;case"mirrored-repeat":return e.MIRRORED_REPEAT;default:return never(r)}}function mapGlTextureFilter(e,r){switch(r){case"nearest":return e.NEAREST;case"linear":return e.LINEAR;case"nearest-mipmap-nearest":return e.NEAREST_MIPMAP_NEAREST;case"linear-mipmap-nearest":return e.LINEAR_MIPMAP_NEAREST;case"nearest-mipmap-linear":return e.NEAREST_MIPMAP_LINEAR;case"linear-mipmap-linear":return e.LINEAR_MIPMAP_LINEAR;default:return never(r)}}function mapGlTextureInternalFormat(e,r){switch(r){case"R8":return e.R8;case"R8_SNORM":return e.R8_SNORM;case"R8UI":return e.R8UI;case"R8I":return e.R8I;case"R16UI":return e.R16UI;case"R16I":return e.R16I;case"R32UI":return e.R32UI;case"R32I":return e.R32I;case"R16F":return e.R16I;case"R32F":return e.R32F;case"RG8":return e.RG8;case"RG8_SNORM":return e.RG8_SNORM;case"RG8UI":return e.RG8UI;case"RG8I":return e.RG8I;case"RG16UI":return e.RG16UI;case"RG16I":return e.RG16I;case"RG32UI":return e.RG32UI;case"RG32I":return e.RG32I;case"RG16F":return e.RG16F;case"RG32F":return e.RG32F;case"RGB8":return e.RGB8;case"RGB8_SNORM":return e.RGB8_SNORM;case"RGB8UI":return e.RGB8UI;case"RGB8I":return e.RGB8I;case"RGB16UI":return e.RGB16UI;case"RGB16I":return e.RGB16I;case"RGB32UI":return e.RGB32UI;case"RGB32I":return e.RGB32I;case"RGB16F":return e.RGB16F;case"RGB32F":return e.RGB32F;case"RGBA8":return e.RGBA8;case"RGBA8_SNORM":return e.RGBA8_SNORM;case"RGBA8UI":return e.RGBA8UI;case"RGBA8I":return e.RGBA8I;case"RGBA16UI":return e.RGBA16UI;case"RGBA16I":return e.RGBA16I;case"RGBA32UI":return e.RGBA32UI;case"RGBA32I":return e.RGBA32I;case"RGBA16F":return e.RGBA16F;case"RGBA32F":return e.RGBA32F;default:return never(r)}}function mapGlTextureFormat(e,r){switch(r){case"RED":return e.RED;case"RG":return e.RG;case"RGB":return e.RGB;case"RGBA":return e.RGBA;case"RED_INTEGER":return e.RED_INTEGER;case"RG_INTEGER":return e.RG_INTEGER;case"RGB_INTEGER":return e.RGB_INTEGER;case"RGBA_INTEGER":return e.RGBA_INTEGER;default:return never(r)}}function mapGlTextureType(e,r){switch(r){case"UNSIGNED_BYTE":return e.UNSIGNED_BYTE;case"UNSIGNED_SHORT":return e.UNSIGNED_SHORT;case"UNSIGNED_INT":return e.UNSIGNED_INT;case"BYTE":return e.BYTE;case"SHORT":return e.SHORT;case"INT":return e.INT;case"FLOAT":return e.FLOAT}}class Device{constructor(e,r,t,a){this.gl=e,this.canvas=r,this.explicitPixelRatio=t,this.explicitViewport=a}static mount(e=document.body,r){if(e instanceof HTMLCanvasElement)return Device.fromCanvas(e,r);const t=document.createElement("canvas");return e.appendChild(t),Device.fromCanvas(t,r)}static fromCanvas(e,r){const t=e.getContext("webgl2");if(!t)throw new Error("Could not get webgl2 context");return Device.fromContext(t,r)}static fromContext(e,{pixelRatio:r,viewport:t,extensions:a}={}){a&&a.forEach(r=>{if(!e.getExtension(r))throw new Error(`Could not get extension ${r}`)});const n=new Device(e,e.canvas,r,t);return n.update(),n}get bufferWidth(){return this.gl.drawingBufferWidth}get bufferHeight(){return this.gl.drawingBufferHeight}get canvasWidth(){return this.canvas.width}get canvasHeight(){return this.canvas.height}get canvasCSSWidth(){return this.canvas.clientWidth}get canvasCSSHeight(){return this.canvas.clientHeight}get pixelRatio(){return this.explicitPixelRatio||window.devicePixelRatio}update(){const e=this.pixelRatio,r=this.canvas,t=this.explicitViewport&&this.explicitViewport[0]||r.clientWidth*e,a=this.explicitViewport&&this.explicitViewport[1]||r.clientHeight*e;t!==r.width&&(r.width=t),a!==r.height&&(r.height=a)}clearColorBuffer(e,r,t,a,n){const c=this.gl;n&&c.bindFramebuffer(c.FRAMEBUFFER,n.glFramebuffer),c.clearColor(e,r,t,a),c.clear(c.COLOR_BUFFER_BIT),n&&c.bindFramebuffer(c.FRAMEBUFFER,null)}clearDepthBuffer(e,r){const t=this.gl;r&&t.bindFramebuffer(t.FRAMEBUFFER,r.glFramebuffer),t.clearDepth(e),t.clear(t.DEPTH_BUFFER_BIT),r&&t.bindFramebuffer(t.FRAMEBUFFER,null)}clearStencilBuffer(e,r){const t=this.gl;r&&t.bindFramebuffer(t.FRAMEBUFFER,r.glFramebuffer),t.clearStencil(e),t.clear(t.STENCIL_BUFFER_BIT),r&&t.bindFramebuffer(t.FRAMEBUFFER,null)}clearColorAndDepthBuffers(e,r,t,a,n,c){const s=this.gl;c&&s.bindFramebuffer(s.FRAMEBUFFER,c.glFramebuffer),s.clearColor(e,r,t,a),s.clearDepth(n),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT),c&&s.bindFramebuffer(s.FRAMEBUFFER,null)}clearDepthAndStencilBuffers(e,r,t){const a=this.gl;t&&a.bindFramebuffer(a.FRAMEBUFFER,t.glFramebuffer),a.clearDepth(e),a.clearStencil(r),a.clear(a.DEPTH_BUFFER_BIT|a.STENCIL_BUFFER_BIT),t&&a.bindFramebuffer(a.FRAMEBUFFER,null)}clearColorAndStencilBuffers(e,r,t,a,n,c){const s=this.gl;c&&s.bindFramebuffer(s.FRAMEBUFFER,c.glFramebuffer),s.clearColor(e,r,t,a),s.clearStencil(n),s.clear(s.COLOR_BUFFER_BIT|s.STENCIL_BUFFER_BIT),c&&s.bindFramebuffer(s.FRAMEBUFFER,null)}clear(e,r,t,a,n,c,s){const i=this.gl;s&&i.bindFramebuffer(i.FRAMEBUFFER,s.glFramebuffer),i.clearColor(e,r,t,a),i.clearDepth(n),i.clearStencil(c),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT|i.STENCIL_BUFFER_BIT),s&&i.bindFramebuffer(i.FRAMEBUFFER,null)}}class VertexBuffer{constructor(e,r,t,a){this.gl=e,this.type=r,this.glType=t,this.glBuffer=createArrayBuffer(e,a)}static create(e,r){const t=e instanceof Device?e.gl:e;switch(r.type){case"i8":return VertexBuffer.fromInt8Array(t,r.data);case"i16":return VertexBuffer.fromInt16Array(t,r.data);case"i32":return VertexBuffer.fromInt32Array(t,r.data);case"u8":return VertexBuffer.fromUint8Array(t,r.data);case"u16":return VertexBuffer.fromUint16Array(t,r.data);case"u32":return VertexBuffer.fromUint32Array(t,r.data);case"f32":return VertexBuffer.fromFloat32Array(t,r.data);default:return never(r)}}static fromInt8Array(e,r){const t=e instanceof Device?e.gl:e;return new VertexBuffer(t,"i8",t.BYTE,r instanceof Int8Array?r:new Int8Array(r))}static fromInt16Array(e,r){const t=e instanceof Device?e.gl:e;return new VertexBuffer(t,"i16",t.SHORT,r instanceof Int16Array?r:new Int16Array(r))}static fromInt32Array(e,r){const t=e instanceof Device?e.gl:e;return new VertexBuffer(t,"i32",t.INT,r instanceof Int32Array?r:new Int32Array(r))}static fromUint8Array(e,r){const t=e instanceof Device?e.gl:e;return new VertexBuffer(t,"u8",t.UNSIGNED_BYTE,r instanceof Uint8Array?r:new Uint8Array(r))}static fromUint16Array(e,r){const t=e instanceof Device?e.gl:e;return new VertexBuffer(t,"u16",t.UNSIGNED_SHORT,r instanceof Uint16Array?r:new Uint16Array(r))}static fromUint32Array(e,r){const t=e instanceof Device?e.gl:e;return new VertexBuffer(t,"u32",t.UNSIGNED_INT,r instanceof Uint32Array?r:new Uint32Array(r))}static fromFloat32Array(e,r){const t=e instanceof Device?e.gl:e;return new VertexBuffer(t,"f32",t.FLOAT,r instanceof Float32Array?r:new Float32Array(r))}}class ElementBuffer{constructor(e,r){this.glBuffer=e,this.count=r}static create(e,r){return Array.isArray(r)?ElementBuffer.fromArray(e,r):ElementBuffer.fromUint32Array(e,r.data)}static fromArray(e,r){return ElementBuffer.fromUint32Array(e,is2DArray(r)?ravel(r).data:r)}static fromUint32Array(e,r){const t=e instanceof Device?e.gl:e,a=Array.isArray(r)?new Uint32Array(r):r,n=createElementArrayBuffer(t,a);return new ElementBuffer(n,a.length)}}const INT_PATTERN$1=/^0|[1-9]\d*$/;class VertexArray{constructor(e,r,t,a){this.glVertexArrayObject=e,this.hasElements=r,this.count=t,this.instanceCount=a}static create(e,{attributes:r,elements:t}){const a=e instanceof Device?e.gl:e,n=[],c=[];Object.entries(r).forEach(([e,r])=>{if(!INT_PATTERN$1.test(e))throw new Error("Location not a number. Use Command#locate");const t=parseInt(e,10);c.push(t),n.push(AttributeDescriptor.create(a,r))});let s;t&&(s=t instanceof ElementBuffer?t:ElementBuffer.create(a,t));const i=createVertexArray(a,n.map((e,r)=>({type:"ipointer"===e.type?1:0,buffer:e.buffer.glBuffer,bufferType:e.buffer.glType,size:e.size,location:c[r],normalized:e.normalized,divisor:e.divisor})),s?s.glBuffer:void 0),u=n.filter(e=>!!e.divisor),o=u.length?u.map(e=>e.count*e.divisor).reduce((e,r)=>Math.min(e,r)):0;return new VertexArray(i,!!s,s?s.count:n[0].count,o)}}class AttributeDescriptor{static create(e,r){if(Array.isArray(r)){if(is2DArray(r)){const t=ravel(r);return new AttributeDescriptor("pointer",VertexBuffer.fromFloat32Array(e,t.data),t.shape[0],t.shape[1],!1,0)}return new AttributeDescriptor("pointer",VertexBuffer.fromFloat32Array(e,r),r.length,1,!1,0)}switch(r.type){case"pointer":return new AttributeDescriptor(r.type,r.value instanceof VertexBuffer?r.value:VertexBuffer.create(e,r.value),r.count,r.size,r.normalized||!1,r.divisor||0);case"ipointer":return new AttributeDescriptor(r.type,r.value instanceof VertexBuffer?r.value:VertexBuffer.create(e,r.value),r.count,r.size,!1,r.divisor||0);default:return never(r)}}constructor(e,r,t,a,n,c){this.type=e,this.buffer=r,this.count=t,this.size=a,this.normalized=n,this.divisor=c}}class Framebuffer{constructor(e,r,t,a){this.glFramebuffer=e,this.glColorAttachments=r,this.width=t,this.height=a}static create(e,{width:r,height:t,color:a,depth:n,stencil:c}){const s=e instanceof Device?e.gl:e,i=s.createFramebuffer();if(!i)throw new Error("Could not create framebuffer");s.bindFramebuffer(s.FRAMEBUFFER,i);const u=Array.isArray(a)?a:[a];u.forEach((e,r)=>{s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0+r,s.TEXTURE_2D,e.glTexture,0)}),n&&s.framebufferTexture2D(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.TEXTURE_2D,n,0),c&&s.framebufferTexture2D(s.FRAMEBUFFER,s.STENCIL_ATTACHMENT,s.TEXTURE_2D,c,0);const o=s.checkFramebufferStatus(s.FRAMEBUFFER);if(s.bindFramebuffer(s.FRAMEBUFFER,null),o!==s.FRAMEBUFFER_COMPLETE)throw s.deleteFramebuffer(i),new Error("Framebuffer not complete");return new Framebuffer(i,u.map((e,r)=>s.COLOR_ATTACHMENT0+r),r,t)}}const INT_PATTERN=/^0|[1-9]\d*$/,UNKNOWN_ATTRIB_LOCATION=-1;class Command{constructor(e,r,t,a,n,c,s,i,u){this.gl=e,this.glProgram=r,this.glPrimitive=t,this.uniformDescrs=a,this.vertexArrayDescr=n,this.framebufferDescr=c,this.depthDescr=s,this.stencilDescr=i,this.blendDescr=u}static create(e,{vert:r,frag:t,uniforms:a={},data:n,framebuffer:c,primitive:s="triangles",depth:i,stencil:u,blend:o}){const f=e instanceof Device?e.gl:e,l=createShader(f,f.VERTEX_SHADER,r),R=createShader(f,f.FRAGMENT_SHADER,t),E=createProgram(f,l,R);f.deleteShader(l),f.deleteShader(R);const A=Object.entries(a).map(([e,r])=>{const t=f.getUniformLocation(E,e);if(!t)throw new Error(`No location for uniform: ${e}`);return new UniformDescriptor(e,t,r)}),m="function"==typeof n||n instanceof VertexArray?n:VertexArray.create(e,locate(f,E,n)),p=c?"function"==typeof c||c instanceof Framebuffer?c:Framebuffer.create(f,c):void 0,h=parseDepth(f,i),d=parseStencil(f,u),F=parseBlend(f,o);return new Command(f,E,mapGlPrimitive(f,s),A,m,p,h,d,F)}execute(e){const{gl:r,glProgram:t}=this;r.useProgram(t),this.beginDepth(),this.beginStencil(),this.beginBlend(),Array.isArray(e)?e.forEach((e,r)=>this.executeInner(e,r)):this.executeInner(e,0),r.bindFramebuffer(r.FRAMEBUFFER,null),r.bindVertexArray(null),this.endBlend(),this.endStencil(),this.endDepth(),r.useProgram(null)}locate(e){return locate(this.gl,this.glProgram,e)}executeInner(e,r){const{gl:t,vertexArrayDescr:a,framebufferDescr:n}=this;let c=t.drawingBufferWidth,s=t.drawingBufferHeight;const i=n?access(e,r,n):void 0;i&&(t.bindFramebuffer(t.FRAMEBUFFER,i.glFramebuffer),t.drawBuffers(i.glColorAttachments),c=i.width,s=i.height),t.viewport(0,0,c,s),this.updateUniforms(e,r);const u=access(e,r,a);t.bindVertexArray(u.glVertexArrayObject),u.hasElements?this.drawElements(u.count,u.instanceCount):this.drawArrays(u.count,u.instanceCount)}beginDepth(){const{gl:e,depthDescr:r}=this;r&&(e.enable(e.DEPTH_TEST),e.depthFunc(r.func),e.depthMask(r.mask),e.depthRange(r.rangeStart,r.rangeEnd))}endDepth(){const{gl:e,depthDescr:r}=this;r&&e.disable(e.DEPTH_TEST)}beginStencil(){const{gl:e,stencilDescr:r}=this;if(r){const{fFunc:t,bFunc:a,fFuncRef:n,bfuncRef:c,fFuncMask:s,bFuncMask:i,fMask:u,bMask:o,fOpSFail:f,bOpSFail:l,fOpDFail:R,bOpDFail:E,fOpDPass:A,bOpDPass:m}=r;e.enable(e.STENCIL_TEST),e.stencilFuncSeparate(e.FRONT,t,n,s),e.stencilFuncSeparate(e.BACK,a,c,i),e.stencilMaskSeparate(e.FRONT,u),e.stencilMaskSeparate(e.BACK,o),e.stencilOpSeparate(e.FRONT,f,R,A),e.stencilOpSeparate(e.BACK,l,E,m)}}endStencil(){const{gl:e,stencilDescr:r}=this;r&&e.disable(e.STENCIL_TEST)}beginBlend(){const{gl:e,blendDescr:r}=this;if(r&&(e.enable(e.BLEND),e.blendFuncSeparate(r.srcRGB,r.dstRGB,r.srcAlpha,r.dstAlpha),e.blendEquationSeparate(r.equationRGB,r.equationAlpha),r.color)){const[t,a,n,c]=r.color;e.blendColor(t,a,n,c)}}endBlend(){const{gl:e,blendDescr:r}=this;r&&e.disable(e.BLEND)}drawArrays(e,r){const{gl:t,glPrimitive:a}=this;r?t.drawArraysInstanced(a,0,e,r):t.drawArrays(a,0,e)}drawElements(e,r){const{gl:t,glPrimitive:a}=this;r?t.drawElementsInstanced(a,e,t.UNSIGNED_INT,0,r):t.drawElements(a,e,t.UNSIGNED_INT,0)}updateUniforms(e,r){const t=this.gl;let a=0;this.uniformDescrs.forEach(({identifier:n,location:c,definition:s})=>{switch(s.type){case"1f":t.uniform1f(c,access(e,r,s.value));break;case"1fv":t.uniform1fv(c,access(e,r,s.value));break;case"1i":t.uniform1i(c,access(e,r,s.value));break;case"1iv":t.uniform1iv(c,access(e,r,s.value));break;case"1ui":t.uniform1ui(c,access(e,r,s.value));break;case"1uiv":t.uniform1uiv(c,access(e,r,s.value));break;case"2f":{const[a,n]=access(e,r,s.value);t.uniform2f(c,a,n);break}case"2fv":t.uniform2fv(c,access(e,r,s.value));break;case"2i":{const[a,n]=access(e,r,s.value);t.uniform2i(c,a,n);break}case"2iv":t.uniform2iv(c,access(e,r,s.value));break;case"2ui":{const[a,n]=access(e,r,s.value);t.uniform2ui(c,a,n);break}case"2uiv":t.uniform2uiv(c,access(e,r,s.value));break;case"3f":{const[a,n,i]=access(e,r,s.value);t.uniform3f(c,a,n,i);break}case"3fv":t.uniform3fv(c,access(e,r,s.value));break;case"3i":{const[a,n,i]=access(e,r,s.value);t.uniform3i(c,a,n,i);break}case"3iv":t.uniform3iv(c,access(e,r,s.value));break;case"3ui":{const[a,n,i]=access(e,r,s.value);t.uniform3ui(c,a,n,i);break}case"3uiv":t.uniform3uiv(c,access(e,r,s.value));break;case"4f":{const[a,n,i,u]=access(e,r,s.value);t.uniform4f(c,a,n,i,u);break}case"4fv":t.uniform4fv(c,access(e,r,s.value));break;case"4i":{const[a,n,i,u]=access(e,r,s.value);t.uniform4i(c,a,n,i,u);break}case"4iv":t.uniform4iv(c,access(e,r,s.value));break;case"4ui":{const[a,n,i,u]=access(e,r,s.value);t.uniform4ui(c,a,n,i,u);break}case"4uiv":t.uniform4uiv(c,access(e,r,s.value));break;case"matrix2fv":t.uniformMatrix2fv(c,!1,access(e,r,s.value));break;case"matrix3fv":t.uniformMatrix3fv(c,!1,access(e,r,s.value));break;case"matrix4fv":t.uniformMatrix4fv(c,!1,access(e,r,s.value));break;case"texture":const i=access(e,r,s.value),u=a++;t.activeTexture(t.TEXTURE0+u),t.bindTexture(t.TEXTURE_2D,i.glTexture),t.uniform1i(c,u);break;default:never(s,`Unknown uniform type: (${n})`)}})}}class DepthDescriptor{constructor(e,r,t,a){this.func=e,this.mask=r,this.rangeStart=t,this.rangeEnd=a}}class StencilDescriptor{constructor(e,r,t,a,n,c,s,i,u,o,f,l,R,E){this.fFunc=e,this.bFunc=r,this.fFuncRef=t,this.bfuncRef=a,this.fFuncMask=n,this.bFuncMask=c,this.fMask=s,this.bMask=i,this.fOpSFail=u,this.bOpSFail=o,this.fOpDFail=f,this.bOpDFail=l,this.fOpDPass=R,this.bOpDPass=E}}class BlendDescriptor{constructor(e,r,t,a,n,c,s){this.srcRGB=e,this.srcAlpha=r,this.dstRGB=t,this.dstAlpha=a,this.equationRGB=n,this.equationAlpha=c,this.color=s}}class UniformDescriptor{constructor(e,r,t){this.identifier=e,this.location=r,this.definition=t}}class Texture{constructor(e,r,t){this.glTexture=e,this.width=r,this.height=t}static fromImage(e,r,t){return Texture.fromRGBA8(e,r.data,r.width,r.height,t)}static fromRGBA8(e,r,t,a,n){return Texture.fromArrayBufferView(e,!r||r instanceof Uint8Array?r:new Uint8Array(r),t,a,"RGBA8","RGBA","UNSIGNED_BYTE",n)}static fromRG16F(e,r,t,a,n){return Texture.fromArrayBufferView(e,!r||r instanceof Float32Array?r:new Float32Array(r),t,a,"RG16F","RG","FLOAT",n)}static fromRGB16F(e,r,t,a,n){return Texture.fromArrayBufferView(e,!r||r instanceof Float32Array?r:new Float32Array(r),t,a,"RGB16F","RGB","FLOAT",n)}static fromRGBA16F(e,r,t,a,n){return Texture.fromArrayBufferView(e,!r||r instanceof Float32Array?r:new Float32Array(r),t,a,"RGBA16F","RGBA","FLOAT",n)}static fromRGB32F(e,r,t,a,n){return Texture.fromArrayBufferView(e,!r||r instanceof Float32Array?r:new Float32Array(r),t,a,"RGB32F","RGB","FLOAT",n)}static fromRGBA32F(e,r,t,a,n){return Texture.fromArrayBufferView(e,!r||r instanceof Float32Array?r:new Float32Array(r),t,a,"RGBA32F","RGBA","FLOAT",n)}static fromArrayBufferView(e,r,t,a,n,c,s,{min:i="nearest",mag:u="nearest",wrapS:o="clamp-to-edge",wrapT:f="clamp-to-edge",mipmap:l=!1}={}){const R=e instanceof Device?e.gl:e;return new Texture(createTexture(R,r,t,a,mapGlTextureInternalFormat(R,n),mapGlTextureFormat(R,c),mapGlTextureType(R,s),mapGlTextureWrap(R,o),mapGlTextureWrap(R,f),mapGlTextureFilter(R,i),mapGlTextureFilter(R,u),l),t,a)}}export{Device,Command,VertexBuffer,ElementBuffer,VertexArray,Texture,Framebuffer};
//# sourceMappingURL=glutenfree.es.min.js.map
